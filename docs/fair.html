<!DOCTYPE html>
<html>
    <head>
    <title>App Fair App</title>
      <style>
            body {
                height: 100vh;
                margin: 0;
                XXXbackground: radial-gradient(circle, rgba(255,255,255,0.2) 80%, rgba(115,115,115,1) 100%);
            }

            .outerlync {
              position: absolute;
              top: 50%;
              left: 50%;
              margin-right: -50%;
              transform: translate(-50%, -50%);
              display: inline-block;
              background: transparent;
            }

            img.innerlync {
              /* max-width: 15vw; */
              /* max-height: 15vh; */
            }
        </style>
    </head>
<body>
    <div>
        <div class="outerlync" style="text-align: center;">
            <div style="backdrop-filter: blur(10px);">
            <h1 id="apptitle" style="text-align: center; font-family: ui-rounded, Arial Rounded MT Bold, Helvetica Rounded, Arial, sans-serif;">Welcome to the App Fair</h1>
            <hr />
            <a id="applink" href="appfair://app/App-Fair"><img class="innerlync" width="150" height="150" id="appicon" onerror="iconError.call(this)" /></a>
            <hr />

            <h5 id="appdesc" style="text-align: center; font-family: system-ui, Arial, sans-serif;">Install this <span id="apptype">app</span> with <a href="https://appfair.app">App Fair.app</a></h5>
            </div>
        </div>
    </div>


    <!-- e.g.: 
        file:///opt/src/github/appfair/App-Fair/docs/app.html#app/Tidal-Zone 
        file:///opt/src/github/appfair/App-Fair/docs/app.html#homebrew/cask/iterm2 
    -->
    <script>
        let appHash = window.location.hash;
        //console.log("HASH", appHash);

        // change the icon preview to be the given source
        function updateIcon(source) {
            document.getElementById("appicon").src = source;
        }

        function iconError() {
            console.log("icon load error:", this.src);
            updateIcon("https://github.com/App-Fair/App/releases/latest/download/App-Fair.png");
        }

        if (typeof appHash === 'string' && appHash != '') {    
            let appPath = appHash.substring(1)
            let appParts = appPath.split("/");
            let appID = appParts[appParts.length - 1];
            let appName = appID.replace("-", " ");

            if (appParts[0] == "app") {  // App Fair app
                updateIcon("https://github.com/" + appID + "/App/releases/latest/download/" + appID + ".png");
                document.getElementById("apptype").innerHTML = 'free appfair.net <a href="http://' + appID + '.github.io/App/">app</a>'
            } else if (appParts[0] == "cask") {  // Homebrew Cask app
                updateIcon("https://github.com/App-Fair/appcasks/releases/download/cask-" + appID + "/AppIcon.png");
                        document.getElementById("apptype").innerHTML = 'Homebrew <a href="https://formulae.brew.sh/' + appPath + '">Cask</a>';
            }

            document.getElementById("apptitle").innerHTML = appName;

            let launchLink = "appfair://" + appPath;
            document.getElementById("applink").href = launchLink;

            // attempt to launch the app fair app
            document.location = launchLink;
        }
    </script>
</body>
</html>

